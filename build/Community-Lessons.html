---
layout: base.njk
styles:
- contribute.css
- lesson-editor.css
---

<div class="content contribute-page">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-book-reader"></i>
            Lecciones de la Comunidad
        </h1>
        <p class="page-subtitle">Lecciones creadas y compartidas por nuestra comunidad</p>
    </div>

    <!-- Filter by Level -->
    <div class="filter-tabs">
        <button class="filter-tab active" data-level="all">
            Todas
        </button>
        <button class="filter-tab" data-level="A1">A1</button>
        <button class="filter-tab" data-level="A2">A2</button>
        <button class="filter-tab" data-level="B1">B1</button>
        <button class="filter-tab" data-level="B2">B2</button>
        <button class="filter-tab" data-level="C1">C1</button>
    </div>

    <div class="level-content">
        <div class="pdf-actions">
            <a href="/ISTANBUL_A1_DERS_KITABI_104S_compressed.pdf" target="_blank" class="btn btn-primary">
                <i class="fas fa-eye"></i>
                Ver PDF
            </a>
            <a href="/ISTANBUL_A1_DERS_KITABI_104S_compressed.pdf" download class="btn btn-secondary">
                <i class="fas fa-download"></i>
                Descargar PDF
            </a>
        </div>
    </div>

    <div class="level-content">
        <div class="pdf-actions">
            <a href="/A2-Turkce-kitabı-yeni_compressed.pdf" target="_blank" class="btn btn-primary">
                <i class="fas fa-eye"></i>
                Ver PDF
            </a>
            <a href="/A2-Turkce-kitabı-yeni_compressed.pdf" download class="btn btn-secondary">
                <i class="fas fa-download"></i>
                Descargar PDF
            </a>
        </div>
    </div>
    <div class="level-content">
        <div class="pdf-actions">
            <a href="/B1-DERS-KITABI_compressed.pdf" target="_blank" class="btn btn-primary">
                <i class="fas fa-eye"></i>
                Ver PDF
            </a>
            <a href="/B1-DERS-KITABI_compressed.pdf" download class="btn btn-secondary">
                <i class="fas fa-download"></i>
                Descargar PDF
            </a>
        </div>
    </div>
    <div class="level-content">
        <div class="pdf-actions">
            <a href="/B2-ders-kitabı_compressed.pdf" target="_blank" class="btn btn-primary">
                <i class="fas fa-eye"></i>
                Ver PDF
            </a>
            <a href="/B2-ders-kitabı_compressed.pdf" download class="btn btn-secondary">
                <i class="fas fa-download"></i>
                Descargar PDF
            </a>
        </div>
    </div>
    <div class="level-content">
        <div class="pdf-actions">
            <a href="/C1-DERS-KITABI_compressed.pdf" target="_blank" class="btn btn-primary">
                <i class="fas fa-eye"></i>
                Ver PDF
            </a>
            <a href="/C1-DERS-KITABI_compressed.pdf" download class="btn btn-secondary">
                <i class="fas fa-download"></i>
                Descargar PDF
            </a>
        </div>
    </div>

    <!-- Lessons List -->
    <div id="lessonsList" class="contributions-list">
        <!-- Will be populated by JavaScript -->
    </div>
</div>

<!-- Lesson Detail Modal -->
<div class="modal" id="lessonModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="lessonTitle">Lesson Title</h2>
            <button class="close-modal" onclick="closeLessonModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body" id="lessonBody">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>
</div>

<script>
    let currentLevel = 'all';

    document.addEventListener('DOMContentLoaded', () => {
        loadLessons();

        // Filter tabs
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                currentLevel = e.target.dataset.level;
                loadLessons();
            });
        });
    });

    function loadLessons() {
        const container = document.getElementById('lessonsList');
        let lessons = window.ContributionService.getPublishedLessons();

        // Filter by level
        if (currentLevel !== 'all') {
            lessons = lessons.filter(l => l.level === currentLevel);
        }

        // Sort by date (newest first)
        lessons.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));

        if (lessons.length === 0) {
            container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-book-open"></i>
                <p>No hay lecciones publicadas todavía</p>
            </div>
        `;
            return;
        }

        container.innerHTML = lessons.map(lesson => `
        <div class="contribution-card published" style="position: relative;">
            <!-- Edit Button -->
            <button class="lesson-edit-btn" onclick="editPublishedLesson('${lesson.id}')">
                <i class="fas fa-edit"></i> Sugerir Edición
            </button>
            
            <div class="contribution-header" onclick="viewLesson('${lesson.id}')" style="cursor: pointer;">
                <div class="contribution-type">
                    <i class="fas fa-book-open"></i>
                    <span>Lección ${lesson.level}</span>
                </div>
                <span class="contribution-status status-published">
                    Publicada
                </span>
            </div>
            <h3 onclick="viewLesson('${lesson.id}')" style="cursor: pointer;">${lesson.title}</h3>
            <p onclick="viewLesson('${lesson.id}')" style="cursor: pointer;">${lesson.description}</p>
            <div class="contribution-meta">
                <span><i class="fas fa-user"></i> ${lesson.author}</span>
                <span><i class="fas fa-calendar"></i> ${formatDate(lesson.publishedAt)}</span>
            </div>
        </div>
    `).join('');
    }

    function viewLesson(id) {
        const lesson = window.ContributionService.getLessonById(id);
        if (!lesson) return;

        document.getElementById('lessonTitle').textContent = lesson.title;
        document.getElementById('lessonBody').innerHTML = `
        <div class="detail-section">
            <h3><i class="fas fa-info-circle"></i> Información</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <strong>Nivel:</strong>
                    <span>${lesson.level}</span>
                </div>
                <div class="detail-item">
                    <strong>Autor:</strong>
                    <span>${lesson.author}</span>
                </div>
                <div class="detail-item">
                    <strong>Fecha:</strong>
                    <span>${formatDate(lesson.publishedAt)}</span>
                </div>
            </div>
        </div>
        <div class="detail-section">
            <h3><i class="fas fa-book"></i> Contenido</h3>
            <div class="lesson-content">
                ${lesson.content}
            </div>
        </div>
    `;

        document.getElementById('lessonModal').style.display = 'flex';
    }

    function closeLessonModal() {
        document.getElementById('lessonModal').style.display = 'none';
    }

    function editPublishedLesson(id) {
        window.location.href = `/Contribute.html?editLesson=${id}`;
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return 'Hoy';
        if (diffDays === 1) return 'Ayer';
        if (diffDays < 7) return `Hace ${diffDays} días`;

        return date.toLocaleDateString('es-ES', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }
</script>

<style>
    .status-published {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .detail-item strong {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .detail-item span {
        color: var(--text-primary);
        font-size: 1rem;
    }
</style>